name: Generate Snake Contribution

on:
  schedule:
    - cron: "0 */6 * * *" # Ejecutar cada 6 horas
  workflow_dispatch:       # Permite ejecución manual

permissions:
  contents: write          # Permite que el workflow haga commits

jobs:
  generate-snake:
    runs-on: ubuntu-latest

    env:
      GITHUB_USER: augvstTTY
      TARGET_BRANCH: main

    steps:
      # 1. Clonar el repositorio
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # Necesario para acceder al historial completo

      # 2. Generar las imágenes de la serpiente
      - name: Generate Snake Images
        uses: Platane/snk@v3
        with:
          github_user_name: ${{ env.GITHUB_USER }}
          outputs: |
            ./github-snake.svg
            ./github-snake-dark.svg?palette=github-dark
            ./snake.gif?color_snake=orange

      # 3. Commit y push de cambios (solo si hay cambios reales)
      - name: Commit and Push Changes
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"

          git add *.svg *.gif
          if git diff --cached --quiet; then
            echo "No hay cambios nuevos para commitear."
            exit 0
          fi

          git commit -m "chore: update snake contribution [skip ci]"
          git push origin ${{ env.TARGET_BRANCH }}

